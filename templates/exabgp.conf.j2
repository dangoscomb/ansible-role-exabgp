process {{ process_name }} {
        run python3 -m exabgp healthcheck --sudo --config {{ exabgp_process_cfg }};
        encoder json;
}

template {
        neighbor controller {
                local-address {{ hostvars[inventory_hostname]['ansible_default_ipv4']['address'] }};
                local-as {{ local_as }};
                peer-as {{ remote_as }};
                hold-time 180;
                group-updates false;
                        capability {
                                graceful-restart 1200;
                        }

                        family {
                                ipv4 unicast;
                        }

{% if use_healthcheck is sameas true %}
                        api { processes [ {{ process_name }} ]; }
{% endif %}
        }
}

{% for bgp_neighbor in bgp_neighbors %}
neighbor {{ bgp_neighbor.ip }} { 
        inherit controller;
        description "{{ bgp_neighbor.desc }}";
}
{% endfor %}
